<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenMo App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            height: 300px; /* Default height for charts */
            width: 100%;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="app-root" class="flex h-screen">
        <!-- Sidebar will be dynamically managed -->
        <aside id="sidebar" class="bg-slate-100 border-r border-slate-200 p-6 flex-shrink-0 flex flex-col justify-between shadow-lg transition-all duration-300 ease-in-out w-64">
            <div>
                <div class="flex items-center gap-3 mb-4"> <!-- Reduced mb-10 to mb-4 to make space for the toggle button -->
                    <div class="w-10 h-10 bg-emerald-600 rounded-lg flex items-center justify-center shadow-md">
                        <span class="text-white text-2xl">🌱</span>
                    </div>
                    <h1 id="greenmo-title" class="text-2xl font-bold text-slate-900">GreenMo</h1>
                </div>
                <!-- Toggle Sidebar Button - Now inside the sidebar, below the logo/title -->
                <button id="toggle-sidebar-btn" class="w-full text-left p-2 rounded-lg bg-emerald-500 text-white shadow-md hover:bg-emerald-600 transition-colors duration-300 mb-6 flex items-center justify-center gap-2">
                    <!-- Icon and text will be dynamically set -->
                </button>
                <nav id="main-nav" class="flex flex-col gap-2">
                    <!-- NavLinks will be dynamically generated -->
                </nav>
            </div>
            <div class="border-t border-slate-200 pt-4">
                <label for="user-selector" class="block text-sm font-medium text-slate-500 mb-2">Simulated User</label>
                <select id="user-selector" class="w-full bg-white border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                    <option value="user123">Jane Doe</option>
                    <option value="user456">John Smith</option>
                    <option value="user789">Alex Ray</option>
                </select>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 p-8 overflow-y-auto transition-all duration-300 ease-in-out">
            <!-- Page content will be rendered here -->
        </main>

        <!-- Toast Container -->
        <div id="toast-container"></div>
    </div>

    <script>
        // Global state variables (mimicking React's useState)
        let currentPage = 'home';
        let currentTradingSubView = 'marketplace';
        let isSidebarOpen = true; // Initial state: sidebar is open
        let toast = null;
        let currentUser = 'user123';
        let currentMatchingItemIndex = 0;
        let showInfoModal = false;
        let currentLeaderboardSubView = 'organization';
        let currentLanguage = 'en'; // Changed: Default language is now English

        // Chart instances for CarbonTrackerPage
        let carbonLineChartInstance = null;
        let carbonPieChartInstance = null;
        let ecoPointsChartInstance = null; // For EcoPointsPage comparison chart

        // Global state for new features in Eco-Points page
        let isWalkingTrackingActive = false;
        let walkingCyclingInterval = null;
        let isReusableImageUploaded = false; // New: for reusable item image upload
        let isWasteScanned = false; // New: for waste sorting step 1
        let currentWasteType = null; // New: for identified waste type

        // Mock data
        let mockData = {
            users: {
                'user123': {
                    name: 'Jane Doe',
                    ecoPoints: 1500,
                    co2Savings: 120.5,
                    lastScanDateReusable: null, // New: for reusable items
                    reusableScansToday: 0,     // New: for reusable items
                    walkingCyclingDistanceKm: 0
                },
                'user456': {
                    name: 'John Smith',
                    ecoPoints: 950,
                    co2Savings: 88.2,
                    lastScanDateReusable: null,
                    reusableScansToday: 0,
                    walkingCyclingDistanceKm: 0
                },
                'user789': {
                    name: 'Alex Ray',
                    ecoPoints: 2100,
                    co2Savings: 155.1,
                    lastScanDateReusable: null,
                    reusableScansToday: 0,
                    walkingCyclingDistanceKm: 0
                },
            },
            organization: {
                name: 'GreenMo HQ',
                greenBadges: 5, // Changed to 5 for user123 to unlock premium
                premiumAccess: false,
                premiumReports: [ // New: Premium report data
                    { id: 1, title: 'Annual Carbon Footprint Report', brief: 'Detailed analysis of your organization\'s yearly carbon emissions and reduction efforts.', price: '$99.99' },
                    { id: 2, title: 'Quarterly Sustainability Impact', brief: 'Overview of environmental impact metrics and sustainability initiatives per quarter.', price: '$49.99' },
                    { id: 3, title: 'Employee Green Engagement Analysis', brief: 'Insights into employee participation in green activities and eco-point earnings.', price: '$79.99' }
                ]
            },
            dashboardMetrics: {
                totalTreesPlanted: 5230,
                totalWasteRecycledKg: 18500,
                cleanEnergyGeneratedKwh: 7500,
            },
            trading: {
                items: [
                    { id: 1, title: 'Vintage Leather Jacket', description: 'Well-preserved, minor wear.', category: 'Apparel', owner: 'Alex Ray', ecoPoints: 300, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Jacket' },
                    { id: 2, title: 'Old Books (Box)', description: 'A collection of classic novels.', category: 'Books', owner: 'Jane Doe', ecoPoints: 150, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Books' },
                    { id: 3, title: 'Retro Gaming Console', description: 'Fully functional, with games.', category: 'Electronics', owner: 'John Smith', ecoPoints: 500, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Console' },
                    { id: 4, title: 'Used Bicycle', description: 'Good for city commutes.', category: 'Transport', owner: 'Alex Ray', ecoPoints: 400, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Bicycle' },
                    { id: 5, title: 'Ceramic Pot Set', description: 'Hand-painted, unique design.', category: 'Household', owner: 'Jane Doe', ecoPoints: 250, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Pots' },
                    { id: 6, title: 'Graphic T-Shirts', description: 'Set of 3, various designs.', category: 'Apparel', owner: 'John Smith', ecoPoints: 180, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=T-Shirts' },
                    { id: 7, title: 'Vintage Camera', description: 'Collectible item, working condition.', category: 'Electronics', owner: 'Jane Doe', ecoPoints: 600, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Camera' },
                    { id: 8, title: 'Kids Toys Bundle', description: 'Assorted toys for young children.', category: 'Toys', owner: 'John Smith', ecoPoints: 100, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Toys' },
                    { id: 9, title: 'Gardening Tools Set', description: 'Used, but in good condition.', category: 'Household', owner: 'Alex Ray', ecoPoints: 220, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Tools' },
                    { id: 10, title: 'Designer Handbag', description: 'Slightly worn, authentic.', category: 'Apparel', owner: 'Jane Doe', ecoPoints: 700, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Handbag' },
                    { id: 11, title: 'Electric Kettle', description: 'Good for quick boils.', category: 'Electronics', owner: 'John Smith', ecoPoints: 120, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Kettle' },
                    { id: 12, title: 'Board Games Collection', description: 'Various family games.', category: 'Toys', owner: 'Alex Ray', ecoPoints: 180, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Games' },
                    { id: 13, title: 'Running Shoes', description: 'Barely used, size 9.', category: 'Apparel', owner: 'Jane Doe', ecoPoints: 280, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Shoes' },
                    { id: 14, title: 'Coffee Maker', description: 'Automatic, clean.', category: 'Household', owner: 'John Smith', ecoPoints: 350, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Coffee' },
                    { id: 15, title: 'Old Records', description: 'Classic rock vinyls.', category: 'Books', owner: 'Alex Ray', ecoPoints: 450, imageUrl: 'https://placehold.co/200x150/E0F2F7/000000?text=Records' },
                ],
                categoryCounts: { 'Apparel': 2, 'Books': 1, 'Electronics': 1, 'Transport': 1, 'Household': 1, 'Toys': 1 }
            },
            carbon: {
                weekly: { labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], data: [1.2, 1.8, 0.9, 2.1, 1.5, 2.5, 2.2] },
                monthly: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], data: [8.5, 9.2, 7.8, 10.1] },
                weeklyActivities: {
                    'Km Walked': 35,
                    'Reusable Cups/Bottles Used': 21,
                    'Recycled Bags Used': 14,
                    'Waste Sorting Count': 49,
                },
                carbonConversionRates: {
                    'kmWalked': 0.1,
                    'reusableItemsUsed': 0.05,
                    'recycledBagsUsed': 0.02,
                    'wasteSortedCount': 0.08,
                },
                ecoPointRate: 10
            },
            pointsTransactions: {
                'user123': [
                    { desc: 'Green Purchase at Go!', points: '+50' },
                    { desc: 'Redeemed 10% Discount', points: '-100' },
                    { desc: 'Tree Planting Event', points: '+150' },
                    { desc: 'Traded Old Books', points: '+20' },
                ],
                'user456': [
                    { desc: 'Used Public Transport', points: '+10' },
                    { desc: 'Donated to WWF', points: '-50' },
                    { desc: 'Green Purchase', points: '+30' },
                ],
                'user789': [
                    { desc: 'Beach Cleanup Volunteer', points: '+200' },
                    { desc: 'Traded Bicycle', points: '+100' },
                    { desc: 'Redeemed 10% Discount', points: '-100' },
                ]
            },
            volunteerEvents: [
                { title: 'City Park Cleanup', type: 'Cleanup', date: 'July 20, 2025', spots: 5, contribution: 'Collected 50kg of waste, cleaned public area.' },
                { title: 'Greenway Tree Planting', type: 'Tree Planting', date: 'July 27, 2025', spots: 12, contribution: 'Planted 100 trees, enhancing urban greenery.' },
                { title: 'Riverfront Restoration', type: 'Cleanup', date: 'August 3, 2025', spots: 8, contribution: 'Cleaned up 30kg of riverside waste, improving water quality.' },
                { title: 'Community Garden Project', type: 'Gardening', date: 'August 10, 2025', spots: 7, contribution: 'Contributed to building a community garden, promoting urban agriculture.' },
                { title: 'Beach Cleanup', type: 'Cleanup', date: 'August 17, 2025', spots: 10, contribution: 'Cleaned up 70kg of beach waste, protecting marine life.' },
            ],
            smeLeaderboard: [
                { rank: 1, name: 'GreenTech Solutions', totalScore: 15000, logo: 'https://placehold.co/60x60/A7F3D0/065F46?text=GS' },
                { rank: 2, name: 'EcoBuilders Inc.', totalScore: 12500, logo: 'https://placehold.co/60x60/D1FAE5/065F46?text=EB' },
                { rank: 3, name: 'Sustainable Futures', totalScore: 10000, logo: 'https://placehold.co/60x60/ECFDF5/065F46?text=SF' },
                { rank: 4, name: 'Innovate Green', totalScore: 9500, logo: 'https://placehold.co/60x60/C8E6C9/065F46?text=IG' },
                { rank: 5, name: 'Clean Air Co.', totalScore: 8800, logo: 'https://placehold.co/60x60/BBDEFB/065F46?text=CAC' },
                { rank: 6, name: 'Recycle Right', totalScore: 7200, logo: 'https://placehold.co/60x60/FFCDD2/065F46?text=RR' },
            ],
            cityLeaderboard: [
                { rank: 1, name: 'Ho Chi Minh City', totalScore: 500000, logo: 'https://placehold.co/60x60/D1FAE5/065F46?text=HCM' },
                { rank: 2, name: 'Hanoi', totalScore: 450000, logo: 'https://placehold.co/60x60/A7F3D0/065F46?text=HN' },
                { rank: 3, name: 'Da Nang', totalScore: 300000, logo: 'https://placehold.co/60x60/ECFDF5/065F46?text=DN' },
                { rank: 4, name: 'Can Tho', totalScore: 280000, logo: 'https://placehold.co/60x60/C8E6C9/065F46?text=CT' },
                { rank: 5, name: 'Hai Phong', totalScore: 250000, logo: 'https://placehold.co/60x60/BBDEFB/065F46?text=HP' },
                { rank: 6, name: 'Hue', totalScore: 200000, logo: 'https://placehold.co/60x60/FFCDD2/065F46?text=HUE' },
            ],
            individualLeaderboard: [
                { rank: 1, name: 'Nguyen Van A', score: 1250, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=NA' },
                { rank: 2, name: 'Tran Thi B', score: 1180, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=TB' },
                { rank: 3, name: 'Le Van C', score: 1100, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=LC' },
                { rank: 4, name: 'Pham Thi D', score: 980, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=PD' },
                { rank: 5, name: 'Hoang Van E', score: 920, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=HE' },
                { rank: 6, name: 'Dang Thi F', score: 850, avatar: 'https://placehold.co/60x60/E0F2F7/000000?text=DF' },
            ],
            ecoPointComparisonData: {
                myActivities: {
                    'Waste Sorting': 25,
                    'Green Packaging Use': 40,
                    'Plastic Bottles Recycled': 15,
                    'Km Cycled': 50,
                },
                friendsActivities: {
                    'friend1': {
                        name: 'Alice',
                        activities: {
                            'Waste Sorting': 20,
                            'Green Packaging Use': 35,
                            'Plastic Bottles Recycled': 10,
                            'Km Cycled': 45,
                        }
                    },
                    'friend2': {
                        name: 'Bob',
                        activities: {
                            'Waste Sorting': 30,
                            'Green Packaging Use': 25,
                            'Plastic Bottles Recycled': 20,
                            'Km Cycled': 60,
                        }
                    },
                    'friend3': {
                        name: 'Charlie',
                        activities: {
                            'Waste Sorting': 18,
                            'Green Packaging Use': 50,
                            'Plastic Bottles Recycled': 12,
                            'Km Cycled': 30,
                        }
                    }
                }
            },
            redemptionOptions: [
                { id: 1, name: '10% Discount Coupon', cost: 100, type: 'coupon' },
                { id: 2, name: 'Eco-friendly Water Bottle', cost: 250, type: 'product' },
                { id: 3, name: 'Reusable Shopping Bag', cost: 150, type: 'product' },
                { id: 4, name: 'Donation to Reforestation (1 Tree)', cost: 500, type: 'donation' },
                { id: 5, name: 'Organic Produce Voucher ($10)', cost: 300, type: 'voucher' },
                { id: 6, name: 'Public Transport Pass (1 Day)', cost: 400, type: 'voucher' },
                { id: 7, name: 'Recycled Notebook Set', cost: 200, type: 'product' },
                { id: 8, name: 'Carbon Offset Credit (100kg CO2)', cost: 700, type: 'donation' },
            ]
        };

        // --- Helper Functions ---

        // Function to render Lucide React icons as SVG strings
        function getLucideIcon(iconName, size = 24, color = 'currentColor') {
            const icons = {
                'Leaf': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-leaf"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8a9 9 0 0 1-18 0c0-2.2.72-7.2 2-10 2.1 2 3.6 2.4 5.5 1.9L11 20z"/></svg>`,
                'Recycle': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-recycle"><path d="M7.61 10.29l-1.12 1.12a3 3 0 0 0 0 4.24l.94.94a3 3 0 0 0 4.24 0l1.12-1.12M16.39 13.71l1.12-1.12a3 3 0 0 0 0-4.24l-.94-.94a3 3 0 0 0-4.24 0l-1.12 1.12M12 22v-3M12 15V9M12 6V2M19.71 7.61l-1.12-1.12a3 3 0 0 0-4.24 0l-.94.94a3 3 0 0 0 0 4.24l1.12 1.12M4.29 16.39l1.12 1.12a3 3 0 0 0 4.24 0l.94-.94a3 3 0 0 0 0-4.24l-1.12-1.12"/></svg>`,
                'Award': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-award"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89L17.76 22l-7.205-2.83L5 22l2.232-9.11A8 8 0 0 1 12 2z"/></svg>`,
                'Users': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M2 21v-2a4 4 0 0 1 3-3.87"/><path d="M19 7h2"/><path d="M22 10h-3"/></svg>`,
                'QrCode': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-qr-code"><rect width="8" height="8" x="2" y="2" rx="1"/><rect width="8" height="8" x="14" y="2" rx="1"/><rect width="8" height="8" x="2" y="14" rx="1"/><path d="M21 16h-3a2 2 0 0 0-2 2v3"/><path d="M21 21v.01"/><path d="M16 16v.01"/><path d="M12 12h.01"/><path d="M12 16h.01"/><path d="M16 12h.01"/><path d="M12 8h.01"/><path d="M8 12h.01"/><path d="M8 16h.01"/></svg>`,
                'TrendingUp': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>`,
                'Trophy': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trophy"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6c.6 0 1 .4 1 1v4c0 .6-.4 1-1 1zm0 0V4m0 5h6m-6 0H2m10 0v4c0 .6-.4 1-1 1H9c-.6 0-1-.4-1-1v-4c0-.6.4-1 1-1h2.5a2.5 2.5 0 0 1 0 5H12c-.6 0-1-.4-1-1v-4c0-.6.4-1 1-1z"/><path d="M12 15v6"/><path d="M12 15H9.5c-.6 0-1 .4-1 1v4c0 .6.4 1 1 1H12c.6 0 1-.4 1-1v-4c0-.6-.4-1-1-1z"/><path d="M12 15h2.5c.6 0 1-.4 1-1v-4c0-.6-.4-1-1-1H12c-.6 0-1 .4-1 1v4c0 .6.4 1 1 1z"/></svg>`,
                'ChevronDown': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="M6 9l6 6 6-6"/></svg>`,
                'ChevronUp': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="M18 15l-6-6-6 6"/></svg>`,
                'MessageSquare': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`,
                'Menu': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>`,
                'X': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
                'CheckCircle': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>`,
                'Info': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`,
                'Scan': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-scan"><path d="M3 7V5a2 2 0 0 1 2-2h2"/><path d="M17 3h2a2 2 0 0 1 2 2v2"/><path d="M21 17v2a2 2 0 0 1-2 2h-2"/><path d="M7 21H5a2 2 0 0 1-2-2v-2"/></svg>`,
                'Lock': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>`,
                'Unlock': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-unlock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>`,
                'BookOpen': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
                'Walk': `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-walk"><path d="M13 14h.01"/><path d="M10 20h4"/><path d="M14 17.5l1.5-2.5"/><path d="M10 17.5l-1.5-2.5"/><path d="M12 13V4"/><path d="M18 10c-1.5-1-2-3-2-3s1.5-2 2.5-3c1.5-1.5 2-1 2-1s.2 1.2-.6 2.3c-.9 1.2-2.4 2.7-3.4 3.7"/><path d="M6 10c1.5-1 2-3 2-3s-1.5-2-2.5-3c-1.5-1.5-2-1-2-1s-.2 1.2.6 2.3c.9 1.2 2.4 2.7 3.4 3.7"/></svg>`
            };
            return icons[iconName] || '';
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toastElement = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-blue-500';
            const iconSvg = type === 'success' ? getLucideIcon('CheckCircle', 20) : getLucideIcon('MessageSquare', 20);

            toastElement.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-xl flex items-center space-x-3 transition-opacity duration-300 z-50`;
            toastElement.innerHTML = `
                ${iconSvg}
                <span>${message}</span>
                <button class="ml-4 text-white hover:text-gray-200">
                    ${getLucideIcon('X', 18)}
                </button>
            `;
            toastContainer.appendChild(toastElement);

            const closeButton = toastElement.querySelector('button');
            closeButton.onclick = () => toastElement.remove();

            setTimeout(() => {
                toastElement.remove();
            }, 3000);
        }

        // --- Page Rendering Functions ---

        function renderNavLink(pageName, iconSvg, text) {
            const isActive = pageName === currentPage;
            const activeClass = isActive ? 'bg-emerald-100 text-emerald-800 font-semibold' : 'text-slate-600 hover:bg-slate-200 hover:text-slate-900 font-medium';
            const sidebarClass = isSidebarOpen ? '' : 'justify-center px-0';
            return `
                <button data-page="${pageName}" class="nav-link flex items-center gap-3 px-4 py-2.5 rounded-lg transition-all duration-200 ${activeClass} ${sidebarClass}">
                    ${iconSvg}
                    ${isSidebarOpen ? text : ''}
                </button>
            `;
        }

        function updateSidebar() {
            const sidebar = document.getElementById('sidebar');
            const toggleButton = document.getElementById('toggle-sidebar-btn');
            const nav = document.getElementById('main-nav');
            const greenmoTitle = document.getElementById('greenmo-title');
            const userSelectorContainer = sidebar.querySelector('.border-t.border-slate-200.pt-4');

            // Ensure elements exist before manipulating them
            if (!sidebar || !toggleButton || !nav || !greenmoTitle || !userSelectorContainer) {
                console.error("Sidebar elements not found in DOM.");
                return;
            }

            if (isSidebarOpen) {
                sidebar.classList.remove('w-20');
                sidebar.classList.add('w-64');
                greenmoTitle.classList.remove('hidden');
                toggleButton.innerHTML = `
                    ${getLucideIcon('X', 24, 'white')}
                `;
                userSelectorContainer.style.display = 'block';
            } else {
                sidebar.classList.remove('w-64');
                sidebar.classList.add('w-20');
                greenmoTitle.classList.add('hidden');
                toggleButton.innerHTML = `
                    ${getLucideIcon('Menu', 24, 'white')}
                `;
                userSelectorContainer.style.display = 'none';
            }

            // Reorder navigation links
            nav.innerHTML = `
                ${renderNavLink('home', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>', 'Home')}
                ${renderNavLink('dashboard', '<svg xmlns="http://www.w3.org/2000/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>', 'Dashboard')}
                ${renderNavLink('points', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>', 'Eco-Points System')}
                ${renderNavLink('carbon', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>', 'Carbon Tracker')}
                ${renderNavLink('trading', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>', 'Trading Hub')}
                ${renderNavLink('volunteer', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>', 'Volunteer Hub')}
                ${renderNavLink('leaderboard', '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>', 'Leaderboard')}
                ${renderNavLink('instructions', getLucideIcon('BookOpen', 20), 'Instructions')}
            `;

            // Re-attach event listeners for nav links
            nav.querySelectorAll('.nav-link').forEach(button => {
                button.onclick = (e) => {
                    navigateTo(e.currentTarget.dataset.page);
                };
            });
        }

        function navigateTo(page) {
            currentPage = page;
            // Clear any active tracking interval when changing pages/users
            if (walkingCyclingInterval) {
                clearInterval(walkingCyclingInterval);
                walkingCyclingInterval = null;
                isWalkingTrackingActive = false; // Reset tracking state
            }
            renderPageContent();
            updateSidebar(); // Update sidebar active state
        }

        function toggleSidebar() {
            isSidebarOpen = !isSidebarOpen;
            updateSidebar();
        }

        function handleUserChange(event) {
            currentUser = event.target.value;
            // Clear any active tracking interval when changing pages/users
            if (walkingCyclingInterval) {
                clearInterval(walkingCyclingInterval);
                walkingCyclingInterval = null;
                isWalkingTrackingActive = false; // Reset tracking state
            }
            renderPageContent(); // Re-render current page with new user data
        }

        // --- HomePage ---
        function renderHomePage() {
            const mainContent = document.getElementById('main-content');
            const featureCardsData = [
                {
                    icon: getLucideIcon('QrCode', 48, '#1A5319'),
                    alt: 'Carbon Tracking',
                    title: 'Carbon Tracking & Eco-Points',
                    description: 'Track your green activities (walking, waste sorting) or pay for eco-friendly products to monitor carbon savings and earn reward points.',
                    color: 'text-emerald-700',
                    targetPage: 'points'
                },
                {
                    icon: getLucideIcon('Users', 48, '#1A5319'),
                    alt: 'Volunteer Hub',
                    title: 'Volunteer Hub',
                    description: 'Participate in local clean-up events and tree planting to earn reward points and make a positive contribution to the community.',
                    color: 'text-blue-700',
                    targetPage: 'volunteer'
                },
                {
                    icon: getLucideIcon('Recycle', 48, '#1A5319'),
                    alt: 'Trading Hub',
                    title: 'Trading Hub',
                    description: 'Exchange pre-loved items or use Eco-Points to redeem used items from users near you, fostering a circular economy.',
                    color: 'text-purple-700',
                    targetPage: 'trading'
                },
                {
                    icon: getLucideIcon('Award', 48, '#1A5319'),
                    alt: 'Leaderboard',
                    title: 'Leaderboard & Green Badges',
                    description: 'Your green efforts will help your company climb the leaderboard and earn prestigious Green Badge titles.',
                    color: 'text-yellow-700',
                    targetPage: 'leaderboard'
                },
                {
                    icon: getLucideIcon('TrendingUp', 48, '#1A5319'),
                    alt: 'Premium Report',
                    title: 'Premium Carbon Reports for SMEs',
                    description: 'A paid feature that provides businesses with valuable reports on their carbon emissions and sustainability impact.',
                    color: 'text-red-700',
                    targetPage: 'carbon'
                },
            ];

            let featureCardsHtml = featureCardsData.map((item, index) => `
                <div data-page="${item.targetPage}" class="relative flex flex-col items-center p-6 bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105 cursor-pointer text-center overflow-hidden w-full max-w-md border border-gray-100">
                    <div class="mb-4 p-4 rounded-full bg-emerald-50 shadow-md ${item.color}">
                        ${item.icon}
                    </div>
                    <h4 class="text-2xl font-bold mb-2 ${item.color}">${item.title}</h4>
                    <p class="text-slate-700 text-sm md:text-base homepage-description" style="max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.3s ease-out, opacity 0.3s ease-out;">
                        ${item.description}
                    </p>
                    <button class="absolute bottom-2 right-2 p-2 rounded-full bg-gray-100 shadow-sm hover:bg-gray-200 transition-colors duration-200 text-slate-600 toggle-description-btn">
                        ${getLucideIcon('ChevronDown', 20)}
                    </button>
                </div>
                ${index < featureCardsData.length - 1 ? `
                    <div class="relative w-0.5 h-16 bg-slate-300">
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 bg-emerald-500 rounded-full border-2 border-white shadow-sm"></div>
                    </div>
                ` : ''}
            `).join('');

            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-12 text-center">
                        <h2 class="text-5xl font-extrabold text-slate-900 leading-tight transition-all duration-300 ease-in-out hover:text-emerald-600 hover:scale-105"
                            style="text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);">
                            Welcome to GreenMo
                        </h2>
                        <p class="text-xl text-slate-600 mt-4 max-w-3xl mx-auto">
                            An innovative super-app ecosystem within MoMo that incentivizes individuals and SMEs to embrace sustainable habits, reduce carbon footprints, and foster economic growth in cities.
                        </p>
                    </header>

                    <section class="mb-12 p-8 bg-gray-50 rounded-2xl shadow-inner border border-gray-200">
                        <h3 class="text-3xl font-bold text-slate-900 mb-4 text-center transition-all duration-300 ease-in-out hover:text-emerald-600 hover:scale-105"
                            style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);">
                            Vision & Mission
                        </h3>
                        <p class="text-lg text-slate-700 leading-relaxed max-w-4xl mx-auto">
                            GreenMo is a super-app ecosystem within MoMo that incentivizes both individuals and SMEs to adopt sustainable habits through gamification, rewards, and community-driven circular economy solutions. Our mission is to make sustainability accessible, rewarding, and impactful for everyone.
                        </p>
                    </section>

                    <section class="mb-12">
                        <h3 class="text-3xl font-bold text-slate-900 mb-8 text-center transition-all duration-300 ease-in-out hover:text-emerald-600 hover:scale-105"
                            style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);">
                            The GreenMo Ecosystem
                        </h3>
                        <div class="flex flex-col lg:flex-row justify-center items-center gap-8">
                            <div class="w-full lg:w-1/3 p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-200 text-center">
                                <h4 class="text-2xl font-bold text-emerald-700 mb-4">For Individuals (B2C)</h4>
                                <ul class="space-y-3 text-lg text-slate-700 text-left mx-auto max-w-xs">
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">👣</span><span>Carbon Footprint Tracking</span></li>
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">✨</span><span>Eco-Points System</span></li>
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">🤝</span><span>Volunteer Activities</span></li>
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl"♻️</span><span>Trading Stuff</span></li>
                                </ul>
                            </div>
                            <div class="w-40 h-40 bg-emerald-600 rounded-full flex items-center justify-center flex-shrink-0 shadow-xl text-white text-center text-xl font-bold">
                                MoMo<br />Super-App
                            </div>
                            <div class="w-full lg:w-1/3 p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-200 text-center">
                                <h4 class="text-2xl font-bold text-emerald-700 mb-4">For SMEs (B2B)</h4>
                                <ul class="space-y-3 text-lg text-slate-700 text-left mx-auto max-w-xs">
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">🏆</span><span>Employee Leaderboard</span></li>
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">📊</span><span>Carbon Dashboard & Reports</span></li>
                                    <li class="flex items-start gap-2"><span class="text-emerald-600 text-xl">🔗</span><span>Circular Marketplace</span></li>
                                </ul>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 mt-8 text-center">Bridged by Social Incentives, Corporate Partnerships, & Government Tie-ins</p>
                    </section>

                    <section class="mb-12 p-8 bg-white rounded-2xl shadow-xl border border-slate-200">
                        <h3 class="text-3xl font-bold text-slate-900 mb-8 text-center">Discover GreenMo Features</h3>
                        <div class="flex flex-col items-center space-y-8">
                            ${featureCardsHtml}
                        </div>
                    </section>
                </div>
            `;

            // Attach event listeners for feature cards and their toggle buttons
            mainContent.querySelectorAll('.relative.flex.flex-col.items-center').forEach(card => {
                card.onclick = (e) => {
                    const targetPage = e.currentTarget.dataset.page;
                    if (targetPage) {
                        navigateTo(targetPage);
                    }
                };
                const toggleBtn = card.querySelector('.toggle-description-btn');
                const descriptionEl = card.querySelector('.homepage-description');
                let isExpanded = false;

                toggleBtn.onclick = (e) => {
                    e.stopPropagation(); // Prevent card click event from firing
                    isExpanded = !isExpanded;
                    if (isExpanded) {
                        descriptionEl.style.maxHeight = `${descriptionEl.scrollHeight}px`;
                        descriptionEl.style.opacity = '1';
                        toggleBtn.innerHTML = getLucideIcon('ChevronUp', 20);
                    } else {
                        descriptionEl.style.maxHeight = '0';
                        descriptionEl.style.opacity = '0';
                        toggleBtn.innerHTML = getLucideIcon('ChevronDown', 20);
                    }
                };
            });
        }

        // --- DashboardPage ---
        let dashboardChartInstance = null; // To hold the Chart.js instance for Dashboard

        function renderDashboardPage() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8">
                        <h2 class="text-4xl font-bold text-slate-900">Ecosystem Dashboard</h2>
                        <p class="text-lg text-slate-500 mt-1">A high-level overview of the GreenMo platform's impact and activity.</p>
                    </header>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                            <h3 class="font-semibold text-slate-500">Total Users</h3>
                            <p id="total-users" class="text-4xl font-bold text-emerald-600 mt-2">1,345</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                            <h3 class="font-semibold text-slate-500">CO2 Saved (Tonnes)</h3>
                            <p id="total-co2" class="text-4xl font-bold text-emerald-600 mt-2">15.7</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                            <h3 class="font-semibold text-slate-500">Items Traded</h3>
                            <p id="total-trades" class="text-4xl font-bold text-emerald-600 mt-2">4,812</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                            <h3 class="font-semibold text-slate-500">Volunteer Hours</h3>
                            <p id="total-hours" class="text-4xl font-bold text-emerald-600 mt-2">2,109</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md text-center">
                            <h3 class="font-semibold text-slate-500">Total Trees Planted</h3>
                            <p class="text-4xl font-bold text-emerald-600 mt-2">${mockData.dashboardMetrics.totalTreesPlanted.toLocaleString()}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md text-center">
                            <h3 class="font-semibold text-slate-500">Total Waste Recycled (kg)</h3>
                            <p class="text-4xl font-bold text-emerald-600 mt-2">${mockData.dashboardMetrics.totalWasteRecycledKg.toLocaleString()}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md text-center">
                            <h3 class="font-semibold text-slate-500">Clean Energy Generated (kWh)</h3>
                            <p class="text-4xl font-bold text-emerald-600 mt-2">${mockData.dashboardMetrics.cleanEnergyGeneratedKwh.toLocaleString()}</p>
                        </div>
                    </div>

                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-1">Activity Overview</h3>
                        <p class="text-slate-500 mb-4">Combined activity across all features in the last 30 days.</p>
                        <div class="chart-container">
                            <canvas id="activity-chart"></canvas>
                        </div>
                    </div>

                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Premium Carbon Report for SMEs</h3>
                        ${!mockData.organization.premiumAccess ? `
                            <div class="flex flex-col items-center justify-center p-4 bg-gray-50 rounded-lg border border-gray-200 text-center">
                                ${getLucideIcon('Lock', 48, '#6B7280')}
                                <p class="text-lg text-slate-700 mb-3">
                                    Unlock comprehensive carbon reports for your organization.
                                </p>
                                <p class="text-sm text-slate-600 mb-4">
                                    Requires 5 Green Badges to unlock. Your organization currently has
                                    <span class="font-bold text-emerald-600">${mockData.organization.greenBadges}</span> Green Badges.
                                </p>
                                <button id="unlock-premium-btn"
                                    class="px-6 py-2 rounded-lg text-white font-semibold transition ${
                                        mockData.organization.greenBadges >= 5
                                            ? 'bg-emerald-600 hover:bg-emerald-700'
                                            : 'bg-gray-400 cursor-not-allowed'
                                    }"
                                    ${mockData.organization.greenBadges < 5 ? 'disabled' : ''}>
                                    ${mockData.organization.greenBadges >= 5 ? `
                                        ${getLucideIcon('Unlock', 18, 'white')} Purchase Report ($99.99)
                                    ` : 'Unlock Premium Report'}
                                </button>
                            </div>
                        ` : `
                            <div class="flex flex-col items-center justify-center p-4 bg-emerald-50 rounded-lg border border-emerald-200 text-center">
                                ${getLucideIcon('CheckCircle', 48, '#059669')}
                                <p class="text-lg font-semibold text-emerald-800">
                                    Premium Report Access Granted!
                                </p>
                                <p class="text-sm text-slate-700 mt-2 mb-4">
                                    You now have access to detailed carbon emission and sustainability impact reports.
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                                    ${mockData.organization.premiumReports.map(report => `
                                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-left">
                                            <h4 class="font-bold text-slate-900">${report.title}</h4>
                                            <p class="text-sm text-slate-600">${report.brief}</p>
                                            <p class="text-emerald-600 font-semibold mt-2">${report.price}</p>
                                            <button class="mt-2 px-4 py-1.5 rounded-lg bg-emerald-600 text-white text-sm hover:bg-emerald-700 transition">
                                                View Report
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;

            // Initialize Chart.js
            if (dashboardChartInstance) {
                dashboardChartInstance.destroy();
            }
            const ctx = document.getElementById('activity-chart').getContext('2d');
            dashboardChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [
                        {
                            label: 'CO2 Saved (kg)',
                            data: [120, 190, 300, 500, 800, 950, 1100],
                            borderColor: '#1A5319',
                            backgroundColor: 'rgba(26, 83, 25, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Items Traded',
                            data: [50, 80, 150, 220, 300, 410, 550],
                            borderColor: '#475569',
                            backgroundColor: 'rgba(100, 116, 139, 0.1)',
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: { maintainAspectRatio: false, responsive: true }
            });

            // Attach event listener for premium unlock button
            const unlockBtn = document.getElementById('unlock-premium-btn');
            if (unlockBtn) {
                unlockBtn.onclick = () => {
                    if (mockData.organization.greenBadges >= 5) {
                        mockData.organization.premiumAccess = true;
                        showToast('Premium Report Unlocked! (Simulated Purchase)', 'success');
                        renderDashboardPage(); // Re-render to show unlocked state
                    }
                };
            }
        }

        // --- TradingHubPage ---
        function renderTradingHubPage() {
            const mainContent = document.getElementById('main-content');
            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8">
                        <h2 class="text-4xl font-bold text-slate-900">Trading Hub</h2>
                        <p class="text-lg text-slate-500 mt-1">This module allows users to exchange pre-loved items, promoting a circular economy. Explore items in a marketplace or find matches with other users.</p>
                    </header>

                    <div class="flex mb-6 space-x-4 border-b border-slate-200">
                        <button id="marketplace-tab-btn" class="px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200 ${currentTradingSubView === 'marketplace' ? 'bg-emerald-500 text-white' : 'hover:bg-slate-100 text-slate-700'}">
                            Marketplace
                        </button>
                        <button id="matching-tab-btn" class="px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200 ${currentTradingSubView === 'matching' ? 'bg-emerald-500 text-white' : 'hover:bg-slate-100 text-slate-700'}">
                            Matching
                        </button>
                    </div>

                    <div id="trading-subview-content"></div>
                </div>
            `;

            document.getElementById('marketplace-tab-btn').onclick = () => {
                currentTradingSubView = 'marketplace';
                renderTradingHubPage(); // Re-render to update tab and content
            };
            document.getElementById('matching-tab-btn').onclick = () => {
                currentTradingSubView = 'matching';
                renderTradingHubPage(); // Re-render to update tab and content
            };

            const subviewContent = document.getElementById('trading-subview-content');
            if (currentTradingSubView === 'marketplace') {
                renderMarketplaceView(subviewContent);
            } else {
                renderMatchingView(subviewContent);
            }
        }

        function renderMarketplaceView(container) {
            let itemsHtml = mockData.trading.items.map(item => `
                <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
                    <img src="${item.imageUrl}" alt="Image of ${item.title}" class="w-full h-48 object-cover p-2" onerror="this.onerror=null;this.src='https://placehold.co/200x150/E0F2F7/000000?text=Item';">
                    <div class="p-4">
                        <h4 class="text-lg font-bold text-slate-900 mb-1">${item.title}</h4>
                        <p class="text-sm text-slate-600 mb-2">${item.description}</p>
                        <span class="text-emerald-600 font-bold text-xl block mb-3">${item.ecoPoints} Eco-Points</span>
                        <div class="flex gap-2 w-full">
                            <button data-item-title="${item.title}" data-item-owner="${item.owner}" class="exchange-btn bg-emerald-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-emerald-700 transition flex-1">Exchange</button>
                            <button data-item-title="${item.title}" class="old-stuff-btn bg-blue-500 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-blue-600 transition flex-1">Old Stuff</button>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="animate-fade-in">
                    <div class="mb-6 flex flex-col sm:flex-row gap-4">
                        <input type="text" placeholder="Search items..." class="flex-1 p-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" />
                        <input type="text" placeholder="Set location (e.g., Ho Chi Minh City)" class="flex-1 p-3 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500" />
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${itemsHtml}
                    </div>
                </div>
            `;

            container.querySelectorAll('.exchange-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const title = e.currentTarget.dataset.itemTitle;
                    const owner = e.currentTarget.dataset.itemOwner;
                    showToast(`Simulating chat for exchanging: "${title}" with ${owner}`, 'info');
                };
            });
            container.querySelectorAll('.old-stuff-btn').forEach(btn => {
                btn.onclick = (e) => {
                    const title = e.currentTarget.dataset.itemTitle;
                    showToast(`Navigating to message page to discuss "${title}".`, 'info');
                };
            });
        }

        function renderMatchingView(container) {
            const currentItem = mockData.trading.items[currentMatchingItemIndex];
            container.innerHTML = `
                <div class="animate-fade-in">
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md mb-6 text-center">
                        <p class="text-lg text-slate-700 font-semibold">
                            Swipe Right (👍) if you like an item, Swipe Left (👎) if you don't. A "match" is created only when both users like each other's items, indicating an accepted exchange!
                        </p>
                    </div>
                    <div class="flex flex-col items-center justify-center h-[500px] bg-slate-100 rounded-xl border border-slate-200 shadow-inner relative overflow-hidden">
                        ${currentItem ? `
                            <div class="bg-white rounded-xl shadow-lg border border-slate-200 w-80 h-96 flex flex-col items-center justify-center p-4">
                                <img src="${currentItem.imageUrl || 'https://placehold.co/200x150/E0F2F7/000000?text=Image+Not+Available'}" alt="Image of ${currentItem.title}" class="w-full h-48 object-contain mb-4 rounded-lg" onerror="this.onerror=null;this.src='https://placehold.co/200x150/E0F2F7/000000?text=Image+Not+Available';">
                                <h4 class="text-xl font-bold text-slate-900 mb-1">${currentItem.title}</h4>
                                <p class="text-sm text-slate-600 text-center">${currentItem.description}</p>
                            </div>
                        ` : `
                            <div class="text-center text-slate-500 text-xl">No more items to match!</div>
                        `}
                        <div class="absolute bottom-6 flex space-x-6">
                            <button id="swipe-left-btn" class="bg-red-500 text-white p-4 rounded-full shadow-lg hover:bg-red-600 transition transform hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                            </button>
                            <button id="swipe-right-btn" class="bg-emerald-500 text-white p-4 rounded-full shadow-lg hover:bg-emerald-600 transition transform hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;

            const handleSwipeLogic = (direction) => {
                if (direction === 'right') {
                    if ((currentMatchingItemIndex + 1) % 3 === 0) {
                        showToast(`It's a Match! You and another user liked "${mockData.trading.items[currentMatchingItemIndex].title}"! Start exchanging!`, 'success');
                    }
                }
                currentMatchingItemIndex = (currentMatchingItemIndex + 1) % mockData.trading.items.length;
                renderTradingHubPage(); // Re-render MatchingView
            };

            if (currentItem) {
                document.getElementById('swipe-left-btn').onclick = () => handleSwipeLogic('left');
                document.getElementById('swipe-right-btn').onclick = () => handleSwipeLogic('right');
            }
        }


        // --- CarbonTrackerPage ---
        let carbonPeriod = 'weekly'; // Local state for CarbonTrackerPage

        function calculateWeeklyCarbonSaved() {
            const weekly = mockData.carbon.weeklyActivities;
            const rates = mockData.carbon.carbonConversionRates;
            let totalCarbonSaved = 0;

            totalCarbonSaved += weekly['Km Walked'] * rates['kmWalked'];
            totalCarbonSaved += weekly['Reusable Cups/Bottles Used'] * rates['reusableItemsUsed'];
            totalCarbonSaved += weekly['Recycled Bags Used'] * rates['recycledBagsUsed'];
            totalCarbonSaved += weekly['Waste Sorting Count'] * rates['wasteSortedCount'];

            return totalCarbonSaved;
        }

        function updateCarbonCharts() {
            // Destroy existing charts if they exist
            if (carbonLineChartInstance) {
                carbonLineChartInstance.destroy();
            }
            if (carbonPieChartInstance) {
                carbonPieChartInstance.destroy();
            }

            // Line Chart for CO2 Savings Trend
            const lineCtx = document.getElementById('carbon-tracker-line-chart').getContext('2d');
            carbonLineChartInstance = new Chart(lineCtx, {
                type: 'line',
                data: {
                    labels: mockData.carbon[carbonPeriod].labels,
                    datasets: [{
                        label: `CO2 Saved (kg)`,
                        data: mockData.carbon[carbonPeriod].data,
                        borderColor: '#1A5319',
                        backgroundColor: 'rgba(26, 83, 25, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: '#1A5319',
                        pointRadius: 4,
                    }]
                },
                options: { maintainAspectRatio: false, responsive: true }
            });

            // Pie Chart for Weekly Green Activities
            const pieCtx = document.getElementById('daily-activities-pie-chart').getContext('2d');
            carbonPieChartInstance = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(mockData.carbon.weeklyActivities),
                    datasets: [{
                        label: 'Weekly Activities',
                        data: Object.values(mockData.carbon.weeklyActivities),
                        backgroundColor: [
                            '#1A5319',
                            '#4CAF50',
                            '#8BC34A',
                            '#CDDC39',
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderCarbonTrackerPage() {
            const mainContent = document.getElementById('main-content');
            const estimatedWeeklyCarbonSaved = calculateWeeklyCarbonSaved().toFixed(2);
            const estimatedWeeklyEcoPoints = (estimatedWeeklyCarbonSaved * mockData.carbon.ecoPointRate).toFixed(0);

            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8">
                        <h2 class="text-4xl font-bold text-slate-900">Carbon Tracker</h2>
                        <p class="text-lg text-slate-500 mt-1">This section visualizes the Carbon Tracker API, which allows users to see their positive environmental impact in real-time. The chart below simulates fetching a user's CO2 savings over a period, demonstrating how data can be dynamically updated based on user selections.</p>
                    </header>
                    <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-slate-900">CO2 Savings Trend (kg)</h3>
                            <div id="carbon-period-selector" class="flex gap-1 bg-slate-100 p-1 rounded-lg">
                                <button data-period="weekly" class="period-btn px-3 py-1 text-sm font-semibold rounded-md ${carbonPeriod === 'weekly' ? 'bg-white text-emerald-700 shadow' : 'text-slate-600'}">Weekly</button>
                                <button data-period="monthly" class="period-btn px-3 py-1 text-sm font-medium rounded-md ${carbonPeriod === 'monthly' ? 'bg-white text-emerald-700 shadow' : 'text-slate-600'}">Monthly</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="carbon-tracker-line-chart"></canvas>
                        </div>
                    </div>

                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                            <h3 class="text-xl font-bold text-slate-900 mb-4">Your Weekly Green Activities</h3>
                            <div class="chart-container h-64">
                                <canvas id="daily-activities-pie-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md flex flex-col justify-center items-center text-center">
                            <h3 class="text-xl font-bold text-slate-900 mb-3">Estimated Weekly Impact</h3>
                            <p class="text-4xl font-bold text-emerald-600 mb-2">${estimatedWeeklyCarbonSaved} kg CO2 Saved</p>
                            <p class="text-2xl font-semibold text-blue-600">~ ${estimatedWeeklyEcoPoints} Eco-Points</p>
                            <p class="text-sm text-slate-500 mt-2">Based on your weekly activities</p>
                        </div>
                    </div>
                </div>
            `;

            // Attach event listeners for period buttons
            document.querySelectorAll('#carbon-period-selector .period-btn').forEach(button => {
                button.onclick = (e) => {
                    carbonPeriod = e.target.dataset.period;
                    renderCarbonTrackerPage(); // Re-render to update selected button and charts
                };
            });

            // Initialize charts after content is in DOM
            updateCarbonCharts();
        }

        // --- EcoPointsPage ---
        let selectedFriend = 'friend1'; // Local state for EcoPointsPage

        // Function to check if reusable item scan limit is reached for today
        function isReusableScanLimitReached() {
            const user = mockData.users[currentUser];
            const today = new Date().toISOString().split('T')[0]; // Get today's date string (YYYY-MM-DD)

            if (user.lastScanDateReusable !== today) {
                user.reusableScansToday = 0; // Reset if it's a new day
                user.lastScanDateReusable = today;
            }
            return user.reusableScansToday >= 2; // Limit 2 per day
        }

        // Function to update walking/cycling distance
        function updateWalkingCyclingDistance() {
            const user = mockData.users[currentUser];
            user.walkingCyclingDistanceKm = (parseFloat(user.walkingCyclingDistanceKm) + 0.1).toFixed(1); // Increment by 0.1 km
            document.getElementById('distance-display').textContent = `${user.walkingCyclingDistanceKm} km`;
        }


        function renderEcoPointsPage() {
            const mainContent = document.getElementById('main-content');
            const user = mockData.users[currentUser];
            const transactions = mockData.pointsTransactions[currentUser];
            const comparisonData = mockData.ecoPointComparisonData;
            const redemptionOptions = mockData.redemptionOptions;

            // Reset image upload state for the current render
            isReusableImageUploaded = false; // Reset for reusable items
            isWasteScanned = false; // Reset for waste sorting
            currentWasteType = null; // Reset for waste sorting

            let transactionsHtml = transactions.map((tx, index) => `
                <li class="flex justify-between items-center p-3 rounded-lg hover:bg-slate-50">
                    <span class="text-slate-700">${tx.desc}</span>
                    <span class="font-bold ${tx.points.startsWith('+') ? 'text-green-600' : 'text-red-600'}">${tx.points}</span>
                </li>
            `).join('');

            let redemptionOptionsHtml = redemptionOptions.map(option => `
                <button data-option-id="${option.id}"
                    class="redeem-btn w-full text-left font-semibold p-3 rounded-lg transition flex justify-between items-center ${
                        user.ecoPoints >= option.cost
                            ? 'bg-emerald-50 hover:bg-emerald-100 text-emerald-800'
                            : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                    }"
                    ${user.ecoPoints < option.cost ? 'disabled' : ''}>
                    <span>${option.name}</span>
                    <span class="font-bold">${option.cost} pts</span>
                </button>
            `).join('');

            let friendOptionsHtml = Object.keys(comparisonData.friendsActivities).map(key => `
                <option value="${key}" ${selectedFriend === key ? 'selected' : ''}>${comparisonData.friendsActivities[key].name}</option>
            `).join('');


            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8">
                        <h2 class="text-4xl font-bold text-slate-900">Eco-Points System</h2>
                        <p class="text-lg text-slate-500 mt-1">Here we demonstrate the Eco-Points API, the core of our incentive system. Users earn points for sustainable actions and can redeem them. The components below simulate fetching a user's balance, viewing their transaction history, and performing a redemption action via an API call.</p>
                    </header>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-1 flex flex-col gap-6">
                            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md text-center">
                                <h3 class="font-semibold text-slate-500">Current Balance</h3>
                                <p id="points-balance" class="text-5xl font-bold text-emerald-600 mt-2">${user.ecoPoints.toLocaleString()}</p>
                                <p class="text-sm text-slate-400 mt-1">Eco-Points</p>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                                <h3 class="text-lg font-bold text-slate-900 mb-3">Redeem Points</h3>
                                <div class="flex flex-col gap-3">
                                    ${redemptionOptionsHtml}
                                </div>
                            </div>
                        </div>
                        <div class="md:col-span-2 flex flex-col gap-6">
                            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">Transaction History</h3>
                                <ul id="points-transactions" class="space-y-3">
                                    ${transactionsHtml}
                                </ul>
                            </div>
                            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">Your Green Activities vs. Friends</h3>
                                <div class="mb-4">
                                    <label for="friend-select" class="block text-sm font-medium text-slate-700 mb-2">Compare with:</label>
                                    <select id="friend-select" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                                        ${friendOptionsHtml}
                                    </select>
                                </div>
                                <div class="chart-container h-80">
                                    <canvas id="eco-points-comparison-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">How to Earn Eco-Points</h3>
                        <div class="flex flex-col gap-6">
                            <!-- Method 1: MoMo Green Payments -->
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 p-3 bg-emerald-50 rounded-full text-emerald-600">
                                    ${getLucideIcon('Leaf', 20)}
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-slate-900">Pay with MoMo at Green-rated Restaurants</h4>
                                    <p class="text-slate-700 text-sm">Earn Eco-Points automatically when you make payments via MoMo at restaurants and businesses officially recognized as 'Green' by GreenMo.</p>
                                </div>
                            </div>

                            <!-- Method 2: Walking/Cycling Tracking -->
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 p-3 bg-emerald-50 rounded-full text-emerald-600">
                                    ${getLucideIcon('Walk', 20)}
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-slate-900">Track Walking/Cycling Distance</h4>
                                    <p class="text-slate-700 text-sm mb-2">Activate the app to track your walking or cycling distance and earn points based on kilometers covered.</p>
                                    <div class="flex items-center gap-4">
                                        <button id="start-tracking-btn" class="px-4 py-2 rounded-lg text-white font-semibold transition ${isWalkingTrackingActive ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}" ${isWalkingTrackingActive ? 'disabled' : ''}>
                                            Start Tracking
                                        </button>
                                        <button id="stop-tracking-btn" class="px-4 py-2 rounded-lg text-white font-semibold transition ${!isWalkingTrackingActive ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-600 hover:bg-red-700'}" ${!isWalkingTrackingActive ? 'disabled' : ''}>
                                            Stop Tracking
                                        </button>
                                        <span id="distance-display" class="text-xl font-bold text-slate-800">${user.walkingCyclingDistanceKm.toFixed(1)} km</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Method 3: Scan QR with Image Verification -->
                            <div class="flex items-start gap-4">
                                <div class="flex-shrink-0 p-3 bg-emerald-50 rounded-full text-emerald-600">
                                    ${getLucideIcon('QrCode', 20)}
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold text-slate-900">Scan QR for Eco-Friendly Actions</h4>
                                    <p class="text-slate-700 text-sm mb-4">Earn Eco-Points by verifying your eco-friendly actions.</p>

                                    <!-- Sub-section 3.1: Reusable Bottle/Recycled Bag Scan -->
                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mb-4">
                                        <h5 class="font-semibold text-slate-800 mb-2">1. Reusable Bottle/Bag Verification (Limit: 2/day)</h5>
                                        <p class="text-slate-600 text-sm mb-3">Upload an image of your reusable bottle or recycled bag in use, then scan the QR code to verify. You can do this up to 2 times per day.</p>
                                        <input type="file" id="reusable-image-upload" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100"/>
                                        <div id="reusable-image-preview" class="w-24 h-24 border border-slate-300 rounded-lg flex items-center justify-center text-slate-400 text-xs overflow-hidden mt-3">
                                            No Image
                                        </div>
                                        <button id="scan-reusable-qr-btn" class="mt-4 bg-emerald-600 text-white px-6 py-2 rounded-lg text-base font-semibold hover:bg-emerald-700 transition w-full ${!isReusableImageUploaded || isReusableScanLimitReached() ? 'opacity-50 cursor-not-allowed' : ''}" ${!isReusableImageUploaded || isReusableScanLimitReached() ? 'disabled' : ''}>
                                            Simulate Scan (Reusable Item)
                                        </button>
                                        <p id="reusable-scan-message" class="text-sm text-slate-500 mt-2">
                                            ${isReusableScanLimitReached() ? `You have reached the limit for reusable item scans today (${user.reusableScansToday}/2).` : (isReusableImageUploaded ? `Image uploaded! You can scan for reusable items (${user.reusableScansToday}/2).` : 'Upload an image to enable reusable item scan.')}
                                        </p>
                                    </div>

                                    <!-- Sub-section 3.2: Waste Sorting -->
                                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <h5 class="font-semibold text-slate-800 mb-2">2. Waste Sorting (Unlimited)</h5>
                                        <p class="text-slate-600 text-sm mb-3">
                                            **Step 1: Scan Waste.** Use your camera to identify the type of waste.
                                            **Step 2: Scan Bin QR.** After sorting, scan the QR code on the designated recycling bin to earn points.
                                        </p>
                                        <button id="scan-waste-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg text-base font-semibold hover:bg-blue-700 transition w-full mb-3">
                                            Simulate Scan Waste
                                        </button>
                                        <p id="waste-type-display" class="text-center text-lg font-bold text-slate-800 mb-3 ${currentWasteType ? '' : 'hidden'}">
                                            Waste Type: <span class="text-emerald-600">${currentWasteType || ''}</span>
                                        </p>
                                        <button id="scan-bin-qr-btn" class="bg-emerald-600 text-white px-6 py-2 rounded-lg text-base font-semibold hover:bg-emerald-700 transition w-full ${!isWasteScanned ? 'opacity-50 cursor-not-allowed' : ''}" ${!isWasteScanned ? 'disabled' : ''}>
                                            Simulate Scan Bin QR
                                        </button>
                                        <p id="waste-scan-message" class="text-sm text-slate-500 mt-2">
                                            ${isWasteScanned ? 'Waste identified! Now scan the bin QR.' : 'Scan waste first to proceed.'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Attach event listeners
            document.querySelectorAll('.redeem-btn').forEach(button => {
                button.onclick = (e) => {
                    const optionId = parseInt(e.currentTarget.dataset.optionId);
                    const option = redemptionOptions.find(opt => opt.id === optionId);
                    if (option && user.ecoPoints >= option.cost) {
                        mockData.users[currentUser].ecoPoints -= option.cost;
                        mockData.pointsTransactions[currentUser].push({ desc: `Redeemed ${option.name}`, points: `-${option.cost}` });
                        showToast(`Successfully redeemed ${option.name}!`, 'success');
                        renderEcoPointsPage(); // Re-render to update balance and history
                    } else {
                        showToast(`Not enough Eco-Points to redeem ${option.name}.`, 'info');
                    }
                };
            });

            document.getElementById('friend-select').onchange = (e) => {
                selectedFriend = e.target.value;
                updateEcoPointsChart();
            };

            // Event listeners for Walking/Cycling Tracking
            const startTrackingBtn = document.getElementById('start-tracking-btn');
            const stopTrackingBtn = document.getElementById('stop-tracking-btn');

            if (startTrackingBtn) {
                startTrackingBtn.onclick = () => {
                    if (!isWalkingTrackingActive) {
                        isWalkingTrackingActive = true;
                        walkingCyclingInterval = setInterval(updateWalkingCyclingDistance, 1000); // Update every second
                        startTrackingBtn.disabled = true;
                        stopTrackingBtn.disabled = false;
                        startTrackingBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                        startTrackingBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        stopTrackingBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        stopTrackingBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                        showToast('Walking/Cycling tracking started!', 'info');
                    }
                };
            }

            if (stopTrackingBtn) {
                stopTrackingBtn.onclick = () => {
                    if (isWalkingTrackingActive) {
                        isWalkingTrackingActive = false;
                        clearInterval(walkingCyclingInterval);
                        const user = mockData.users[currentUser];
                        const pointsEarned = Math.floor(user.walkingCyclingDistanceKm * 2); // Example: 2 points per km
                        user.ecoPoints += pointsEarned;
                        mockData.pointsTransactions[currentUser].push({ desc: `Walk/Cycle Tracking: ${user.walkingCyclingDistanceKm} km`, points: `+${pointsEarned}` });
                        showToast(`Tracking stopped! Earned ${pointsEarned} Eco-Points!`, 'success');
                        startTrackingBtn.disabled = false;
                        stopTrackingBtn.disabled = true;
                        startTrackingBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        startTrackingBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                        stopTrackingBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        stopTrackingBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                        renderEcoPointsPage(); // Re-render to update points and history
                    }
                };
            }

            // Event listener for Reusable Item Image Upload
            const reusableImageUpload = document.getElementById('reusable-image-upload');
            const reusableImagePreview = document.getElementById('reusable-image-preview');
            const scanReusableQrBtn = document.getElementById('scan-reusable-qr-btn');
            const reusableScanMessage = document.getElementById('reusable-scan-message');

            if (reusableImageUpload) {
                reusableImageUpload.onchange = (e) => {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            reusableImagePreview.innerHTML = `<img src="${event.target.result}" alt="Uploaded Image" class="w-full h-full object-cover rounded-lg">`;
                            isReusableImageUploaded = true;
                            // Update reusable QR scan button state
                            if (!isReusableScanLimitReached()) {
                                scanReusableQrBtn.disabled = false;
                                scanReusableQrBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                                reusableScanMessage.textContent = `Image uploaded! You can scan for reusable items (${user.reusableScansToday}/2).`;
                            } else {
                                scanReusableQrBtn.disabled = true;
                                scanReusableQrBtn.classList.add('opacity-50', 'cursor-not-allowed');
                                reusableScanMessage.textContent = `You have reached the limit for reusable item scans today (${user.reusableScansToday}/2).`;
                            }
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    } else {
                        reusableImagePreview.innerHTML = 'No Image';
                        isReusableImageUploaded = false;
                        scanReusableQrBtn.disabled = true;
                        scanReusableQrBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        reusableScanMessage.textContent = 'Upload an image to enable reusable item scan.';
                    }
                };
            }

            // Reusable Item QR scan button logic
            if (scanReusableQrBtn) {
                scanReusableQrBtn.onclick = () => {
                    if (isReusableImageUploaded && !isReusableScanLimitReached()) {
                        const pointsToAdd = 50; // Points for reusable item scan
                        user.ecoPoints += pointsToAdd;
                        user.reusableScansToday += 1;
                        user.lastScanDateReusable = new Date().toISOString().split('T')[0]; // Store today's date
                        mockData.pointsTransactions[currentUser].push({ desc: `Reusable Item Scan: ${user.reusableScansToday}/2`, points: `+${pointsToAdd}` });
                        showToast(`Reusable item scanned! Earned ${pointsToAdd} Eco-Points!`, 'success');
                        renderEcoPointsPage(); // Re-render to update points, history, and button state
                    } else if (isReusableScanLimitReached()) {
                        showToast(`You have reached the limit for reusable item scans today (${user.reusableScansToday}/2).`, 'info');
                    } else {
                        showToast('Please upload an image to verify your reusable item first.', 'info');
                    }
                };
            }

            // Event listeners for Waste Sorting
            const scanWasteBtn = document.getElementById('scan-waste-btn');
            const wasteTypeDisplay = document.getElementById('waste-type-display');
            const scanBinQrBtn = document.getElementById('scan-bin-qr-btn');
            const wasteScanMessage = document.getElementById('waste-scan-message');
            const wasteTypes = ['Plastic', 'Paper', 'Organic', 'Glass', 'Metal'];

            if (scanWasteBtn) {
                scanWasteBtn.onclick = () => {
                    const randomWasteType = wasteTypes[Math.floor(Math.random() * wasteTypes.length)];
                    currentWasteType = randomWasteType;
                    isWasteScanned = true;
                    wasteTypeDisplay.textContent = `Waste Type: ${currentWasteType}`;
                    wasteTypeDisplay.classList.remove('hidden');
                    scanBinQrBtn.disabled = false;
                    scanBinQrBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    wasteScanMessage.textContent = 'Waste identified! Now scan the bin QR.';
                    showToast(`Simulated scan: Identified as ${currentWasteType} waste!`, 'info');
                };
            }

            if (scanBinQrBtn) {
                scanBinQrBtn.onclick = () => {
                    if (isWasteScanned) {
                        const pointsToAdd = 20; // Points for waste sorting
                        user.ecoPoints += pointsToAdd;
                        mockData.pointsTransactions[currentUser].push({ desc: `Waste Sorted: ${currentWasteType}`, points: `+${pointsToAdd}` });
                        showToast(`Bin QR scanned! Earned ${pointsToAdd} Eco-Points for sorting ${currentWasteType} waste!`, 'success');
                        isWasteScanned = false;
                        currentWasteType = null;
                        wasteTypeDisplay.classList.add('hidden');
                        scanBinQrBtn.disabled = true;
                        scanBinQrBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        wasteScanMessage.textContent = 'Scan waste first to proceed.';
                        renderEcoPointsPage(); // Re-render to update points and history
                    } else {
                        showToast('Please scan the waste first before scanning the bin QR.', 'info');
                    }
                };
            }

            // Initialize/Update Chart
            updateEcoPointsChart();
        }

        function updateEcoPointsChart() {
            if (ecoPointsChartInstance) {
                ecoPointsChartInstance.destroy();
            }

            const comparisonData = mockData.ecoPointComparisonData;
            const friendActivities = comparisonData.friendsActivities[selectedFriend]?.activities || {};
            const labels = Object.keys(comparisonData.myActivities);
            const myData = Object.values(comparisonData.myActivities);
            const friendData = labels.map(label => friendActivities[label] || 0);

            const ctx = document.getElementById('eco-points-comparison-chart').getContext('2d');
            ecoPointsChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Your Activities',
                            data: myData,
                            backgroundColor: '#1A5319',
                            borderColor: '#064E3B',
                            borderWidth: 1
                        },
                        {
                            label: `${comparisonData.friendsActivities[selectedFriend]?.name}'s Activities`,
                            data: friendData,
                            backgroundColor: '#475569',
                            borderColor: '#334155',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantity'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Activity Type'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            });
        }


        // --- VolunteerHubPage ---
        function renderVolunteerHubPage() {
            const mainContent = document.getElementById('main-content');
            let eventsHtml = mockData.volunteerEvents.map(event => `
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                    <h4 class="text-lg font-bold text-slate-900">${event.title}</h4>
                    <p class="text-sm text-slate-500 mt-1">${event.type} &bull; ${event.date}</p>
                    <div class="flex justify-between items-center mt-4">
                        <p class="text-sm text-slate-500">${event.spots} spots left</p>
                        <button class="register-btn bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-emerald-700 transition">Register</button>
                    </div>
                </div>
            `).join('');

            let historyHtml = mockData.volunteerEvents.map((event, index) => `
                <li class="p-4 rounded-lg bg-slate-50 border border-slate-200">
                    <h4 class="text-lg font-semibold text-slate-800 mb-1">${event.title} <span class="text-sm text-slate-500 font-normal">(${event.date})</span></h4>
                    <p class="text-slate-700 text-sm">
                        <span class="font-medium">Contribution:</span> ${event.contribution}
                    </p>
                </li>
            `).join('');

            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8">
                        <h2 class="text-4xl font-bold text-slate-900">Volunteer Hub</h2>
                        <p class="text-lg text-slate-500 mt-1">The Volunteer Hub connects users with local environmental events. This module simulates fetching a list of upcoming events from the API. Users can interact by "registering" for an event, which demonstrates how a POST request would update the event's status for that user.</p>
                    </header>
                    <div id="volunteer-events-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${eventsHtml}
                    </div>

                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Volunteer Activity History and Contributions</h3>
                        <ul class="space-y-4">
                            ${historyHtml}
                        </ul>
                    </div>
                </div>
            `;

            document.querySelectorAll('.register-btn').forEach(button => {
                button.onclick = (e) => {
                    showToast('Registration successful! (Simulation only)', 'success');
                    e.target.textContent = 'Registered!';
                    e.target.classList.remove('bg-emerald-600', 'hover:bg-emerald-700');
                    e.target.classList.add('bg-gray-400');
                    e.target.disabled = true;
                };
            });
        }

        // --- LeaderboardPage ---
        function renderLeaderboardPage() {
            const mainContent = document.getElementById('main-content');
            let smeTop3Html = mockData.smeLeaderboard.slice(0, 3).map((sme, index) => `
                <div class="flex flex-col items-center p-4 rounded-xl shadow-md transition-all duration-300 ${index === 0 ? 'bg-yellow-500 text-white scale-105 relative -top-4' : 'bg-white text-slate-800'}">
                    ${index === 0 ? '<span class="absolute -top-3 -right-3 bg-yellow-400 text-yellow-900 font-bold px-3 py-1 rounded-full text-sm shadow-lg">👑 #1</span>' : ''}
                    <img src="${sme.logo}" alt="Logo of ${sme.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-md mb-3" />
                    <h4 class="text-xl font-bold mb-1">${sme.name}</h4>
                    <p class="text-lg font-semibold">${sme.totalScore.toLocaleString()} points</p>
                    <p class="text-sm opacity-80">Rank #${sme.rank}</p>
                </div>
            `).join('');

            let smeListHtml = mockData.smeLeaderboard.slice(3).map(sme => `
                <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-50">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-slate-500 w-6 text-center">${sme.rank}</span>
                        <span class="font-semibold text-slate-800">${sme.name}</span>
                    </div>
                    <span class="font-bold text-emerald-600">${sme.totalScore.toLocaleString()} points</span>
                </li>
            `).join('');

            let cityTop3Html = mockData.cityLeaderboard.slice(0, 3).map((city, index) => `
                <div class="flex flex-col items-center p-4 rounded-xl shadow-md transition-all duration-300 ${index === 0 ? 'bg-blue-500 text-white scale-105 relative -top-4' : 'bg-white text-slate-800'}">
                    ${index === 0 ? '<span class="absolute -top-3 -right-3 bg-blue-400 text-blue-900 font-bold px-3 py-1 rounded-full text-sm shadow-lg">🏆 #1</span>' : ''}
                    <img src="${city.logo}" alt="Logo of ${city.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-md mb-3" />
                    <h4 class="text-xl font-bold mb-1">${city.name}</h4>
                    <p class="text-lg font-semibold">${city.totalScore.toLocaleString()} points</p>
                    <p class="text-sm opacity-80">Rank #${city.rank}</p>
                </div>
            `).join('');

            let cityListHtml = mockData.cityLeaderboard.slice(3).map(city => `
                <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-50">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-slate-500 w-6 text-center">${city.rank}</span>
                        <span class="font-semibold text-slate-800">${city.name}</span>
                    </div>
                    <span class="font-bold text-emerald-600">${city.totalScore.toLocaleString()} points</span>
                </li>
            `).join('');

            let individualTop3Html = mockData.individualLeaderboard.slice(0, 3).map((individual, index) => `
                <div class="flex flex-col items-center p-4 rounded-xl shadow-md transition-all duration-300 ${index === 0 ? 'bg-purple-500 text-white scale-105 relative -top-4' : 'bg-white text-slate-800'}">
                    ${index === 0 ? '<span class="absolute -top-3 -right-3 bg-purple-400 text-purple-900 font-bold px-3 py-1 rounded-full text-sm shadow-lg">⭐ #1</span>' : ''}
                    <img src="${individual.avatar}" alt="Avatar of ${individual.name}" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-md mb-3" />
                    <h4 class="text-xl font-bold mb-1">${individual.name}</h4>
                    <p class="text-lg font-semibold">${individual.score.toLocaleString()} points</p>
                    <p class="text-sm opacity-80">Rank #${individual.rank}</p>
                </div>
            `).join('');

            let individualListHtml = mockData.individualLeaderboard.slice(3).map(individual => `
                <li class="flex items-center justify-between p-3 rounded-lg hover:bg-slate-50">
                    <div class="flex items-center gap-4">
                        <span class="font-bold text-slate-500 w-6 text-center">${individual.rank}</span>
                        <span class="font-semibold text-slate-800">${individual.name}</span>
                    </div>
                    <span class="font-bold text-emerald-600">${individual.score.toLocaleString()} points</span>
                </li>
            `).join('');

            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8 flex justify-between items-center">
                        <h2 class="text-4xl font-bold text-slate-900">Leaderboard</h2>
                        <button id="info-modal-btn" class="p-2 rounded-full bg-gray-100 text-slate-600 hover:bg-gray-200 transition-colors duration-200" aria-label="Leaderboard Information">
                            ${getLucideIcon('Info', 24)}
                        </button>
                    </header>
                    <p class="text-lg text-slate-500 mt-1 mb-8">View the top companies and cities based on their total green points.</p>

                    <div id="info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 ${showInfoModal ? '' : 'hidden'}">
                        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full relative">
                            <button id="close-info-modal-btn" class="absolute top-2 right-2 p-1 rounded-full bg-gray-100 hover:bg-gray-200">
                                ${getLucideIcon('X', 20)}
                            </button>
                            <h3 class="text-xl font-bold text-slate-900 mb-4">Leaderboard Information</h3>
                            <p class="text-slate-700">
                                The leaderboard will be reset monthly. Top 3 will receive titles and members of the top 3 organizations will get exciting benefits!
                            </p>
                        </div>
                    </div>

                    <div class="flex mb-6 space-x-4 border-b border-slate-200">
                        <button data-leaderboard-type="organization" class="leaderboard-tab-btn px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200 ${currentLeaderboardSubView === 'organization' ? 'bg-emerald-500 text-white' : 'hover:bg-slate-100 text-slate-700'}">
                            Green Organization Leaderboard
                        </button>
                        <button data-leaderboard-type="city" class="leaderboard-tab-btn px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200 ${currentLeaderboardSubView === 'city' ? 'bg-emerald-500 text-white' : 'hover:bg-slate-100 text-slate-700'}">
                            Green City Leaderboard
                        </button>
                        <button data-leaderboard-type="individual" class="leaderboard-tab-btn px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200 ${currentLeaderboardSubView === 'individual' ? 'bg-emerald-500 text-white' : 'hover:bg-slate-100 text-slate-700'}">
                            Individual Leaderboard
                        </button>
                    </div>

                    <section id="leaderboard-content" class="mb-12 bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-200 animate-fade-in">
                        <!-- Content will be injected here based on currentLeaderboardSubView -->
                    </section>
                </div>
            `;

            // Attach event listeners for info modal
            document.getElementById('info-modal-btn').onclick = () => {
                showInfoModal = true;
                renderLeaderboardPage(); // Re-render to show modal
            };
            document.getElementById('close-info-modal-btn').onclick = () => {
                showInfoModal = false;
                renderLeaderboardPage(); // Re-render to hide modal
            };

            // Attach event listeners for leaderboard tabs
            document.querySelectorAll('.leaderboard-tab-btn').forEach(button => {
                button.onclick = (e) => {
                    currentLeaderboardSubView = e.currentTarget.dataset.leaderboardType;
                    renderLeaderboardPage(); // Re-render to update tab and content
                };
            });

            const leaderboardContentDiv = document.getElementById('leaderboard-content');
            if (currentLeaderboardSubView === 'organization') {
                leaderboardContentDiv.innerHTML = `
                    <h3 class="text-2xl font-bold text-slate-900 mb-6 text-center">Top 3 SMEs</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        ${smeTop3Html}
                    </div>
                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Green Organization Leaderboard</h3>
                        <ul class="space-y-2">
                            ${smeListHtml}
                        </ul>
                    </div>
                `;
            } else if (currentLeaderboardSubView === 'city') {
                leaderboardContentDiv.innerHTML = `
                    <h3 class="text-2xl font-bold text-slate-900 mb-6 text-center">Top 3 Cities</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        ${cityTop3Html}
                    </div>
                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Green City Leaderboard</h3>
                        <ul class="space-y-2">
                            ${cityListHtml}
                        </ul>
                    </div>
                `;
            } else if (currentLeaderboardSubView === 'individual') {
                leaderboardContentDiv.innerHTML = `
                    <h3 class="text-2xl font-bold text-slate-900 mb-6 text-center">Top 3 Individuals</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-end">
                        ${individualTop3Html}
                    </div>
                    <div class="mt-8 bg-white p-6 rounded-xl border border-slate-200 shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Individual Leaderboard</h3>
                        <ul class="space-y-2">
                            ${individualListHtml}
                        </ul>
                    </div>
                `;
            }
        }

        // --- Instructions Page ---
        function renderInstructionsPage() {
            const mainContent = document.getElementById('main-content');

            const multilingualInstructions = {
                'vi': {
                    title: "Hướng dẫn sử dụng ứng dụng GreenMo",
                    description: "Dưới đây là hướng dẫn chi tiết về cách bạn có thể tương tác với các tính năng chính trong ứng dụng:",
                    sections: [
                        {
                            title: "1. Điều hướng trong ứng dụng",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>',
                            description: `
                                <p class="mb-2"><strong>Chọn người dùng:</strong> Ở phía bên trái, dưới thanh điều hướng, bạn sẽ thấy một hộp chọn có nhãn "Simulated User" (Người dùng mô phỏng). Bạn có thể chọn giữa "Jane Doe", "John Smith" và "Alex Ray" để xem ứng dụng hoạt động như thế nào với dữ liệu của các người dùng khác nhau.</p>
                                <p><strong>Chuyển đổi giữa các tab:</strong> Sử dụng các nút điều hướng ở thanh bên trái (ví dụ: "Home", "Dashboard", "Eco-Points System", v.v.) để chuyển đổi giữa các phần khác nhau của ứng dụng.</p>
                            `
                        },
                        {
                            title: "2. Mở khóa Báo cáo Carbon cao cấp (dành cho SME)",
                            icon: '<svg xmlns="http://www.w3.org/2000/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>',
                            description: `
                                <p class="mb-2">Tính năng này có sẵn trong tab "Dashboard" (Bảng điều khiển).</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong>Chọn "Jane Doe":</strong> Đảm bảo bạn đã chọn "Jane Doe" trong hộp chọn "Simulated User" ở thanh bên trái, vì người dùng này đã được cấu hình để có đủ "Green Badges" (Huy hiệu Xanh) để mở khóa báo cáo cao cấp.</li>
                                    <li><strong>Truy cập Dashboard:</strong> Nhấp vào "Dashboard" trong thanh điều hướng bên trái.</li>
                                    <li><strong>Mở khóa báo cáo:</strong> Cuộn xuống phần "Premium Carbon Report for SMEs" (Báo cáo Carbon cao cấp cho SME). Bạn sẽ thấy nút "Unlock Premium Report" (Mở khóa Báo cáo cao cấp). Nhấp vào nút này.</li>
                                    <li><strong>Xem các loại báo cáo:</strong> Sau khi nhấp, bạn sẽ thấy thông báo "Premium Report Access Granted!" (Quyền truy cập Báo cáo cao cấp đã được cấp!) và một danh sách các báo cáo cao cấp có sẵn, bao gồm mô tả ngắn gọn và giá của chúng.</li>
                                </ul>
                            `
                        },
                        {
                            title: "3. Kiếm Eco-Points (Điểm sinh thái)",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>',
                            description: `
                                <p class="mb-2">Bạn có thể tìm thấy các phương pháp kiếm điểm này trong tab "Eco-Points System" (Hệ thống Eco-Point). Nhấp vào "Eco-Points System" trong thanh điều hướng bên trái.</p>
                                <h4 class="font-semibold text-slate-800 mb-1">Thanh toán bằng MoMo tại các nhà hàng được xếp hạng xanh:</h4>
                                <p class="text-slate-700 text-sm mb-3">Đây là một phương pháp kiếm điểm tự động. Khi bạn thực hiện thanh toán qua MoMo tại các nhà hàng hoặc doanh nghiệp được GreenMo công nhận là "Xanh", điểm Eco-Point sẽ được cộng tự động vào số dư của bạn. Không cần hành động thủ công nào trong ứng dụng để mô phỏng điều này; nó được giả định là xảy ra trong nền thông qua các giao dịch MoMo.</p>
                                <h4 class="font-semibold text-slate-800 mb-1">Theo dõi khoảng cách đi bộ/đạp xe:</h4>
                                <ul class="list-disc list-inside space-y-1 mb-3">
                                    <li><strong>Bước 1: Bắt đầu theo dõi:</strong> Nhấp vào nút "Start Tracking" (Bắt đầu theo dõi) trong phần "Track Walking/Cycling Distance" (Theo dõi khoảng cách đi bộ/đạp xe). Bạn sẽ thấy khoảng cách (km) bắt đầu tăng lên.</li>
                                    <li><strong>Bước 2: Dừng theo dõi:</strong> Khi bạn muốn dừng, nhấp vào nút "Stop Tracking" (Dừng theo dõi). Ứng dụng sẽ tính toán điểm Eco-Point bạn kiếm được dựa trên khoảng cách đã đi và cộng vào số dư của bạn.</li>
                                </ul>
                                <h4 class="font-semibold text-slate-800 mb-1">Quét QR cho các hành động thân thiện với môi trường:</h4>
                                <p class="text-slate-700 text-sm mb-2">Kiếm Eco-Points bằng cách xác minh các hành động thân thiện với môi trường của bạn. Phần này được chia thành hai loại:</p>
                                <ul class="list-disc list-inside space-y-1 ml-4">
                                    <li><strong>Xác minh chai/túi tái sử dụng (Giới hạn: 2 lần/ngày):</strong>
                                        <ul class="list-circle list-inside ml-4">
                                            <li><strong>Bước 1: Tải ảnh lên:</strong> Trong phần "Reusable Bottle/Bag Verification" (Xác minh chai/túi tái sử dụng), nhấp vào "Choose File" (Chọn tệp) và chọn một hình ảnh từ thiết bị của bạn (mô phỏng việc chụp ảnh chai/túi của bạn). Hình ảnh sẽ xuất hiện trong phần xem trước.</li>
                                            <li><strong>Bước 2: Mô phỏng quét QR:</strong> Sau khi ảnh được tải lên, nút "Simulate Scan (Reusable Item)" (Mô phỏng quét (Vật phẩm tái sử dụng)) sẽ được kích hoạt (trừ khi bạn đã đạt giới hạn 2 lần/ngày). Nhấp vào nút này để kiếm điểm.</li>
                                            <li><em>Lưu ý: Bạn chỉ có thể kiếm điểm từ hành động này tối đa 2 lần mỗi ngày.</em></li>
                                        </ul>
                                    </li>
                                    <li><strong>Phân loại rác (Không giới hạn):</strong>
                                        <ul class="list-circle list-inside ml-4">
                                            <li><strong>Bước 1: Mô phỏng quét rác:</strong> Trong phần "Waste Sorting" (Phân loại rác), nhấp vào nút "Simulate Scan Waste" (Mô phỏng quét rác). Ứng dụng sẽ mô phỏng việc xác định loại rác (ví dụ: nhựa, giấy) và hiển thị nó.</li>
                                            <li><strong>Bước 2: Mô phỏng quét QR thùng rác:</strong> Sau khi loại rác được xác định, nút "Simulate Scan Bin QR" (Mô phỏng quét QR thùng rác) sẽ được kích hoạt. Nhấp vào nút này để xác nhận bạn đã phân loại rác đúng cách và kiếm điểm Eco-Point.</li>
                                            <li><em>Lưu ý: Bạn có thể thực hiện hành động này không giới hạn số lần mỗi ngày.</em></li>
                                        </ul>
                                    </li>
                                </ul>
                            `
                        },
                        {
                            title: "4. Theo dõi Carbon",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>',
                            description: "Trực quan hóa tác động môi trường tích cực của bạn thông qua các biểu đồ tiết kiệm CO2. Bạn có thể xem dữ liệu hàng tuần hoặc hàng tháng."
                        },
                        {
                            title: "5. Trung tâm trao đổi",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>',
                            description: "Duyệt và trao đổi các vật phẩm đã qua sử dụng. Tính năng này thúc đẩy nền kinh tế tuần hoàn bằng cách kết nối người dùng để trao đổi vật phẩm."
                        },
                        {
                            title: "6. Trung tâm tình nguyện",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>',
                            description: "Kết nối bạn với các sự kiện môi trường địa phương. Bạn có thể xem các sự kiện sắp tới và đăng ký tham gia."
                        },
                        {
                            title: "7. Bảng xếp hạng",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>',
                            description: "Xem thứ hạng của bạn, cũng như các tổ chức và thành phố, dựa trên tổng số điểm xanh. Khuyến khích cạnh tranh lành mạnh và sự tham gia."
                        }
                    ]
                },
                'en': {
                    title: "GreenMo App Instructions",
                    description: "Here's a detailed guide on how you can interact with the main features in the app:",
                    sections: [
                        {
                            title: "1. App Navigation",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>',
                            description: `
                                <p class="mb-2"><strong>Select User:</strong> On the left sidebar, below the navigation, you'll find a dropdown labeled "Simulated User". You can choose between "Jane Doe", "John Smith", and "Alex Ray" to see how the app functions with different user data.</p>
                                <p><strong>Switch Tabs:</strong> Use the navigation buttons on the left sidebar (e.g., "Home", "Dashboard", "Eco-Points System", etc.) to switch between different sections of the app.</p>
                            `
                        },
                        {
                            title: "2. Unlock Premium Carbon Report (for SMEs)",
                            icon: '<svg xmlns="http://www.w3.org/2000/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>',
                            description: `
                                <p class="mb-2">This feature is available in the "Dashboard" tab.</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li><strong>Select "Jane Doe":</strong> Ensure you have "Jane Doe" selected in the "Simulated User" dropdown on the left sidebar, as this user is configured to have enough "Green Badges" to unlock the premium report.</li>
                                    <li><strong>Access Dashboard:</strong> Click on "Dashboard" in the left navigation bar.</li>
                                    <li><strong>Unlock Report:</strong> Scroll down to the "Premium Carbon Report for SMEs" section. You will see an "Unlock Premium Report" button. Click on it.</li>
                                    <li><strong>View Report Types:</strong> After clicking, you will see a "Premium Report Access Granted!" message and a list of available premium reports, including their brief descriptions and prices.</li>
                                </ul>
                            `
                        },
                        {
                            title: "3. Earn Eco-Points",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>',
                            description: `
                                <p class="mb-2">You can find these earning methods in the "Eco-Points System" tab. Click on "Eco-Points System" in the left navigation bar.</p>
                                <h4 class="font-semibold text-slate-800 mb-1">Pay with MoMo at Green-rated Restaurants:</h4>
                                <p class="text-slate-700 text-sm mb-3">This is an automatic earning method. When you make payments via MoMo at restaurants and businesses officially recognized as 'Green' by GreenMo, Eco-Points will be automatically added to your balance. No manual action is needed in the app to simulate this; it's assumed to happen in the background via MoMo transactions.</p>
                                <h4 class="font-semibold text-slate-800 mb-1">Track Walking/Cycling Distance:</h4>
                                <ul class="list-disc list-inside space-y-1 mb-3">
                                    <li><strong>Step 1: Start Tracking:</strong> Click the "Start Tracking" button in the "Track Walking/Cycling Distance" section. You will see the distance (km) start to increase.</li>
                                    <li><strong>Step 2: Stop Tracking:</strong> When you wish to stop, click the "Stop Tracking" button. The app will calculate the Eco-Points you earned based on the distance covered and add them to your balance.</li>
                                </ul>
                                <h4 class="font-semibold text-slate-800 mb-1">Scan QR for Eco-Friendly Actions:</h4>
                                <p class="text-slate-700 text-sm mb-2">Earn Eco-Points by verifying your eco-friendly actions. This section is divided into two types:</p>
                                <ul class="list-disc list-inside space-y-1 ml-4">
                                    <li><strong>Reusable Bottle/Bag Verification (Limit: 2/day):</strong>
                                        <ul class="list-circle list-inside ml-4">
                                            <li><strong>Step 1: Upload Image:</strong> In the "Reusable Bottle/Bag Verification" section, click "Choose File" and select an image from your device (simulating taking a photo of your bottle/bag). The image will appear in the preview area.</li>
                                            <li><strong>Step 2: Simulate QR Scan:</strong> After the image is uploaded, the "Simulate Scan (Reusable Item)" button will be enabled (unless you've reached the 2-per-day limit). Click this button to earn points.</li>
                                            <li><em>Note: You can earn points from this action a maximum of 2 times per day.</em></li>
                                        </ul>
                                    </li>
                                    <li><strong>Waste Sorting (Unlimited):</strong>
                                        <ul class="list-circle list-inside ml-4">
                                            <li><strong>Step 1: Simulate Scan Waste:</strong> In the "Waste Sorting" section, click the "Simulate Scan Waste" button. The app will simulate identifying the type of waste (e.g., plastic, paper) and display it.</li>
                                            <li><strong>Step 2: Simulate Scan Bin QR:</strong> After the waste type is identified, the "Simulate Scan Bin QR" button will be enabled. Click this button to confirm you've sorted the waste correctly and earn Eco-Points.</li>
                                            <li><em>Note: You can perform this action an unlimited number of times per day.</em></li>
                                        </ul>
                                    </li>
                                </ul>
                            `
                        },
                        {
                            title: "4. Carbon Tracker",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>',
                            description: "Visualize your positive environmental impact through CO2 savings charts. You can view data on a weekly or monthly basis."
                        },
                        {
                            title: "5. Trading Hub",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>',
                            description: "Browse and exchange pre-loved items. This feature promotes a circular economy by connecting users for item swaps."
                        },
                        {
                            title: "6. Volunteer Hub",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>',
                            description: "Connects you with local environmental events. You can view upcoming events and register to participate."
                        },
                        {
                            title: "7. Leaderboard",
                            icon: '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>',
                            description: "View your ranking, as well as organizations and cities, based on total green points. Encourages healthy competition and engagement."
                        }
                    ]
                }
            };

            const currentContent = multilingualInstructions[currentLanguage];

            let instructionsHtml = currentContent.sections.map(item => `
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-md flex items-start gap-4 animate-fade-in">
                    <div class="flex-shrink-0 p-3 bg-emerald-50 rounded-full text-emerald-600">
                        ${item.icon}
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-slate-900 mb-2">${item.title}</h3>
                        <div class="text-slate-700">${item.description}</div>
                    </div>
                </div>
            `).join('');

            mainContent.innerHTML = `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl max-w-4xl w-full mx-auto">
                    <header class="mb-8 flex justify-between items-center">
                        <h2 class="text-4xl font-bold text-slate-900">${currentContent.title}</h2>
                        <select id="language-selector" class="p-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-emerald-500 focus:border-emerald-500">
                            <option value="vi" ${currentLanguage === 'vi' ? 'selected' : ''}>Tiếng Việt</option>
                            <option value="en" ${currentLanguage === 'en' ? 'selected' : ''}>English</option>
                        </select>
                    </header>
                    <p class="text-lg text-slate-500 mt-1 mb-8">${currentContent.description}</p>
                    <div class="flex flex-col gap-6">
                        ${instructionsHtml}
                    </div>
                </div>
            `;

            // Attach event listener for language selector
            document.getElementById('language-selector').onchange = (e) => {
                currentLanguage = e.target.value;
                renderInstructionsPage(); // Re-render the page with new language
            };
        }

        // --- Main App Logic ---
        function renderPageContent() {
            switch (currentPage) {
                case 'home':
                    renderHomePage();
                    break;
                case 'dashboard':
                    renderDashboardPage();
                    break;
                case 'trading':
                    renderTradingHubPage();
                    break;
                case 'carbon':
                    renderCarbonTrackerPage();
                    break;
                case 'points':
                    renderEcoPointsPage();
                    break;
                case 'volunteer':
                    renderVolunteerHubPage();
                    break;
                case 'leaderboard':
                    renderLeaderboardPage();
                    break;
                case 'instructions':
                    renderInstructionsPage();
                    break;
                default:
                    renderHomePage();
            }
        }

        // Initial render when the DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('toggle-sidebar-btn').onclick = toggleSidebar;
            document.getElementById('user-selector').onchange = handleUserChange;
            renderApp();
        });

        function renderApp() {
            updateSidebar(); // Render sidebar initially based on isSidebarOpen
            renderPageContent(); // Render the current page content
        }
    </script>
</body>
</html>
